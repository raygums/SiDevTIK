# Dokumentasi: Pipeline ini menyalin kode dari Bitbucket ke GitHub saat ada push.
image: atlassian/default-image:4

pipelines:
  default:
    - step:
        name: Sync to GitHub
        script:
          # 1. Setup SSH dari Variable Bitbucket
          - mkdir -p ~/.ssh
          - echo "$GITHUB_SSH_KEY" > ~/.ssh/id_rsa
          - chmod 600 ~/.ssh/id_rsa
          - ssh-keyscan github.com >> ~/.ssh/known_hosts
          
          # 2. Config Git & Remote
          - git config --global user.email "bot@bitbucket.org"
          - git config --global user.name "Bitbucket Sync Bot"
          # Ganti URL di bawah sesuai repo GitHub kamu
          - git remote add github git@github.com:raygums/domain-tik.git
          
          # 3. Fetch History Lengkap
          # Bitbucket secara default melakukan 'shallow clone', kita butuh full history
          - git fetch --unshallow || true
          
          # 4. Push ke GitHub
          # Variabel $BITBUCKET_BRANCH otomatis disediakan oleh sistem
          - echo "ðŸ”„ Syncing branch $BITBUCKET_BRANCH to GitHub..."
          - git push github $BITBUCKET_BRANCH